\documentclass[preprint]{elsarticle}
\usepackage[latin1]{inputenc}
\usepackage[english]{babel}
%\usepackage[T1]{fontenc}
%\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{color}
%\usepackage{setspace}
\usepackage{url}

\begin{document}

\begin{frontmatter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   TITLE   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Mobility analysis in a Smart City}
% Antonio - Esto es por poner algo, hay que cambiarlo, claro

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   AUTHORS   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\author{A.J. Fernández-Ares$^1$, A.M. Mora$^1$, M.G. Arenas$^1$, P. García-Sanchez$^1$, \\ G. Romero$^1$, V. Rivas$^2$, P.A. Castillo$^1$, J.J. Merelo$^1$}
\ead{\{antares, amorag, mgarenas, pablogarcia, gustavo, pacv, jmerelo\}@ugr.es, vrivas@ujaes.es}
\address{$^1$ Departamento de Arquitectura y Tecnología de Computadores.\\ ETSIIT - CITIC. University of Granada, Spain\\
$^2$ Departamento de Informática. EPS. Universidad de Jaén, Spain}

%\maketitle

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   ABSTRACT   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\begin{abstract}

This paper presents a set of applications of an own mobility monitoring system addressing several problems in a Smart City scope.
This system tracks the movement of people and vehicles analysing the  radioelectric space, specifically, the  WiFi and Bluetooth signals emitted by personal (smartphones) or on-board (hands-free) devices. 

The study has been conducted in four different real scenarios: two related with people mobility (a public building and a discotheque); and two focused in traffic tracking (urban and intercity roads).

Different Data Mining techniques have been applied to extract useful knowledge, traffic forecasting methods to perform reliable predictions, and statistical analyses to model or validate the system accuracy (using different data sources).

The obtained results show the viability and utility of the system, along with its multiple applications for real Smart Cities issues. 

\end{abstract}

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   KEYWORDS   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\begin{keyword}
Smart City \sep Smart traffic \sep Transit indicators \sep Traffic forecast \sep Mobility analysis
\end{keyword}
% Antonio - A añadir y mejorar

\end{frontmatter}


%-------------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   INTRODUCTION   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%-------------------------------------------------------------------------------

\section{Introduction}
\label{sec:intro}

Nowadays, any system that collect reliable traffic information which is useful for wide population must be in mind for the society because the information increases the ability of improvement of any community. The information in our society is power and everybody tries to get it from any trustworthy source. Moreover, if this information is not available using any other previous commercial system, the innovation, the improvement and the success is guaranteed.

Traffic information is currently gathered using several kind of devices. The local, regional or national governments use these data aiming for improvements in the maintenance of roads and services, for computing useful traffic statistics, or to optimize the traffic light synchronization, among other uses. This information is considered in several ways, from improving the traffic flow inside the city to the end-users, drivers, who can profit by optimally planning their trips according to the current, or future, status of the traffic flow. Thus, gathered traffic information must be reliable and useful both, in real time and also in the near future, by means of forecasting tools, for instance.

The traffic monitors nowadays include pneumatic tubes, loop detectors, floating vehicles or automatic Optical Character Recognition (OCR) among others, but most of them are not able to identify and follow the same vehicle along the road network. In this paper we present a system able to do this while improving the quality of the gathered information and allowing the easy construction of traffic flow models or mobility graphs. In addition, the proposed system is formed by low-cost devices, which is another advantage over the usual monitoring systems, since the cost is an important factor for authorities which tend to install the simplest and cheapest monitors.

Each device, evolution of the one presented in \cite{castillo2014_book_sipesca}, is based in a single-board computer which monitors the radioelectric space catching Bluetooth (BT) and WiFi signals emitted by other devices. These will be mainly smartphones or hands-free systems on vehicles, which are detected and identified by means of their Media Access Control number (MAC) - which is unique - and stored as a traffic `step'. 
% Antonio - ¿Se os ocurre un nombre mejor para los 'pasos'?
Thus, depending on the position of the monitoring device, we could gather information about specific people or vehicles displacements. In order to respect the person's privacy and data protection laws, the MAC is one-direction encrypted before storing it, so, we cannot relate a captured MAC with any person.

In this paper we present, four different scenarios centred in the city of Granada (Spain), in which real traffic/mobility data have been gathered. They are namely: a discotheque, a public building of the University, a highway between Granada and Málaga; and one of the main streets in the city. 
Several devices or nodes have been deployed in each scenario.
The data have been deeply processed in this work, using different techniques, such as time series forecasting, clustering, in/out matrices, and statistical methods.
The aim is to extract useful information and conclusions in every scenario, proving the value of this monitoring system as a tool to improve different issues inside the city and buildings. Thus, the system would be suitable to be part of a \textit{Smart City}.
% Antonio - Hay que hacer referencias a Smart City a lo largo del paper. ;)

The rest of the work is structured as follows. Section \ref{sec:soa} presents the background and state of the art on the main topics of the work: traffic and mobility monitoring, traffic series forecast, and smart city tools, among others.
Then, our monitoring device is introduced in Section \ref{sec:mobywit}.
After this, there are four sections devoted to describe and analyze a different scenario, namely: Section \ref{sec:disco} explains the discotheque scenario and the methods applied to its data, Section \ref{sec:etsiit} presents the study on the University building, Section \ref{sec:traffic} shows the analysis on the highway traffic, and Section \ref{sec:city} comments the scenario on the street of Granada.
Finally, Section \ref{sec:conclusions} plots the conclusions reached in the work.


%----------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   STATE OF THE ART  %%%%%%%%%%%%%%%%%%%%%%%%%%%
%----------------------------------------------------------------------------


\section{Background and state of the art}
\label{sec:soa}

Several technologies are used to collect data and gather information about the 
state of the roads. Traffic monitoring technologies can be classified as 
intrusive, installed in the pavement, and not-intrusive, without contact with 
the road, causing minimal effect on the traffic flow \cite{martin2003detector}.

Main technologies currently used include pneumatic tubes, inductive loop 
detectors and automatic recognition systems, among others 
\cite{rodrigue2013geography}.

Pneumatic tubes are placed on top of the lane to detect vehicles by the change 
in pressure generated when a vehicle passes over the tube. An inductive loop 
detector is a wire embedded into the roadway usually in a square configuration. 
A electric current is sent to the wire and when a metal surface with certain 
minimum area pass or is stopped above a pulse is triggered and detected. The 
main drawback of these two systems is that they are unable to identify the 
vehicle detected by the sensor. This way, the highly desired origin/destination 
matrices cannot be obtained. Just the number of vehicles and their type can be 
guessed. This count, although valuable, does not allow us to know many traffic 
flow characteristics like, for example, repetitive passes of the same vehicle. 
Because of their relatively high cost of installation and maintenance it is not 
feasible to install them all over our roads. That's way we can only see them on 
major roads, cities and points of special interest.

Finally, the automatic recognition technology has experienced an increase in 
recent years due to its ability to detect individual vehicles without relying 
on in-vehicle systems. Video image detection is a good example; in this case a 
trip line and/or tracking are used to record traffic data. Furthermore, they 
are used for automatic detection of incidents on the road. That is the main 
advantage over previous information systems. However, system reliability might 
not be the best, as weather may limit accuracy. Moreover, these systems are 
very expensive compared to the previously described \cite{skszek2001state}. 
Another problem has arisen recently with privacy. The Spanish Data Protection 
Agency (Agencia de Protección de Datos) considers the car license plate number 
as personal data. As such, user consent is required for it to be saved.

There are many different companies working in the traffic information field 
using approaches like the previously described in this work. Some of the more 
relevant are:

\begin{itemize}
\item Bit Carrier \cite{mendez2011system,BitCarrier}: It offers a traffic 
management system based in BT to count people and commercial routes 
(pathsolver). Its technology was deployed in highways managed by Abertis for 
traffic flow control and monitoring. Actually it has a network of 150 devices 
in Catalonia capable of tracking 200000 people every day.
\item Trafficnow \cite{Trafficnow}: Offers a traffic flow control center for 
small towns. It requires a net of BT sensors. A pilot experience has been 
deployed in Vigo.
\item Traffax Inc \cite{TraffaxInc}: It is a company that also has used 
BT for calculating origin-destination and transport time matrices.
\item Savari Networks \cite{SavariNetworks}: It offers the commercial 
product StreetWAVE for traffic monitoring to know in real time the 
traffic status.
\item TrafficCast \cite{TrafficCast}: They have developed prediction models 
in different cities based on different technologies, such as video cameras and 
BT devices and RFID tags included in the vehicles wanted to be followed.
\end{itemize}


- Talk about traffic modeling and forecast or other analyses on it.\\
% El estado del arte de la predicción de trafico, voy a poner la idea en español en comentarios para estructurármela yo misma en la cabeza.

The traffic flow forecasting in a dual carriageway, in a road, or in any transport way plays an important role for alleviating urban congestions, or for arranging traffic control systems and traffic guidance systems. The main goal is design intelligent transportation systems (ITS) and it cannot be realized without an ability to anticipate traffic conditions in the short-term (less than one hour into the future) although the medium-term or the large-term would help too. In short-term forecasting the traffic control systems could adapt along the time. For example, a traffic light could adjust its red or green time depending on the short-time forecasting of its close streets. Moreover medium-term or long-term could to be useful if there is special conditions in a medium or long time period although nowadays the results of this research is not outstanding and it is an open question for many research groups, but usually in other subjects like time series in general \cite{ParrasGutierrez2014433} or economic development and political decisions 	\cite{longTermBussines2014}. 

%La predicción del tráfico en una ciudad, una carretera o en general cualquier vía de transporte es esencial para mejorar el transporte. Los %usuarios de cualquier transporte público estarían más contentos si el flujo de tráfico de una ciudad cumpliera unos tiempos preestablecidos, puesto que así el transporte sería más rápido y eficiente. Sin embargo es un problema totalmente abierto en el que numerosos investigadores de todo el mundo realizan sus aportaciones. (Accurate and real-time traffic flow forecasting is essential to adaptive traffic control system and traffic guidance system, which is of great significance for alleviating urban traffic congestions. Because of the importance of traffic flow prediction results, many traffic engineering researchers began to apply mature prediction models of other areas to short-term traffic flow prediction and developed a variety of forecasting methods at the beginning of the 1960s. )


There are many research papers related with traffic flow forecasting and each of them focus the problem from their authors point of view. All the contribution are important because each of them assists the problem with a particular bit. The diverse solutions provided by the researches include \cite{SurveyKumar2007} series models, Kalman Filter Theory, Markov Chain models, non-parametric methods, simulation models, local regression models, fuzzy-neural approaches, sequential learning, spectral analysis, Basesian networks, neural networks, diffusion models or Big Data based approaches.  %(buscar referencias recientes de cada una y ponerlas si queremos ampliar este párrafo)

% Existen numerosos trabajos relacionados con la predicción de tráfico y cada uno de ellos enfoca el problema de formas diferentes. Estos enfoques incluyen "series models, Kalman Filter Theory, Markov Chain models, non-parametric methods simulation models, local regression models, fuzzy-neural approaches, sequential learning, spectral analysis, Bayesian networks, neural networks, modelos de difusión o la técnicas de bigdata. (buscar referencias recientes de cada una y ponerlas)

Being the traffic flow forecasting a trending topic several surveys exist and they provide a comprehensive idea about the scope \cite{SurveyBolshinsky2012}. The authors, E. Bolshinsky and R. Friedman try to give an added value to their contribution including the used techniques, the system input data for each contribution, and some of the hardware architectures the papers describe. Other previous survey were written like \cite{Survey2004} and \cite{SurveyKumar2007} but Bolshinsky's et Al. one complet the information. There are specific surveys for one of the traffic flow forecasting types, like \cite{Vlahogianni2014} where the focus was not the approaches or the results of the reviewed papers, but the focus or goals and the scope where each paper could be classified. For example if the paper forecast the expected time for one trip or if the paper included the system which collected data as main contribution.

% Al tratarse de un tema muy estudiado, existen también numerosos resúmenes que te dan una idea general sobre este ámbito como el [SurveyKumar2007] publicado en el 2007 y centrado en la predicción del tráfico a corto plazo, o el publicado en 2012 por E. Bolshinsky [SurveyBolshinsky2012] donde se repasan las diferentes técnicas utilizadas, los datos de entrada que necesita cada una y algunas arquitecturas de los sistemas utilizados. También hay resúmenes específicos para un tipo de predicción como el propio [SurveyKumar2007] o [Vlahogianni2014] que tiene un enfoque un poco más generalista clasificando la literatura existente en los objetivos que perseguía cada trabajo o dentro de qué ambito estaba emarcado cada artículo, como por ejemplo si predecía el tráfico o predecía el tiempo esperado para un desplazamiento o estaba centrado en la forma de recolección de los datos utilizados.

During the last years, the publications even assimilate new technologies for data analysis like "Big Data" \cite{TrafficFlowPredictionWithBigData2015} or Cloudcomputing approaches \citep{CloudComputing2014}. In \cite{TrafficFlowPredictionWithBigData2015} Yisheng et. al. tackle the traffic flow forecasting problem using temporal and spatial models at the same time using simple forecasting models and assembling them in a global complex system. The results contribute with a time and a spatial place for each prediction. In \citep{CloudComputing2014} Zhaosheng Yang et al. presented traffic flow prediction model for large-scale road network based on cloud computing, which was implemented successfully by introducing genetic algorithm and support vector machine. 


%Algunos de los trabajos más recientes que versan sobre la predicción del tráfico intentan ya integrar nuevas tecnologías como "Big Data" [TrafficFlowPredictionWithBigData2015] donde intentan abarcar nuevos enfoques en la predicción incluyendo una predicción temporal y espacial simultáneamente utilizando modelos de predicción simples como piezas que forman un sistema mucho más complejo.

Several renowned publications offer to their contributors spacial issues related with the scope, like \cite{Zhang20141}. This publication includes the last advances in traffic forecasting research. Some of them forecast the traffic flows and the trip times \citep{Dong201420}, \cite{Zou201433} or forecast spatial-temporal patterns of the congested and non-congested traffic or papers with new real-time forecasting approaches \cite{Zhang201465} or improved and renowned proposals like \cite{Wang201479} and \cite{Qi201495}. 

%También existen numerosas revistas que proponen números especiales que versan sobre este tema [Zhang20141], donde se puede encontrar los últimos avances que intentan ir más allá y predecir no sólo el estado del tráfico sino el tiempo de los desplazamientos [Dong201420] [Zou201433]  utilizando modelos espacio-temporales del tráfico en diferentes situaciones (spatial?temporal patterns of the congested and non-congested traffic) o trabajos que le dan una vuelta de tuerca más a las técnicas y proponen nuevos métodos de predicción [Zhang201465] utilizando datos del tráfico en tiempo real o métodos ya conocidos y mejorados como [Wang201479][Qi201495].

% Antonio - he movido este texto que es más de background a esta sección. ;)
% TODO: GUSTAVO, ¿podrías poner citas a esos temas? ;D
People's mobility is studied for important reasons. Many of them involve profit: conversion rate, marketing effectiveness or staff planning are some of the best known. 

Conversion rate is the percentage of visitors who effectively make a purchase. It can show you if a shop improvement (or decline) is due to more people visit it or more of the visitors finally buy something. Shopping mall professionals study people behavior in order to know if their marketing techniques are paying off. In the same line, stuff planning is directly related with the amount of visitors, as is the maintenance and cleaning needs.

Other reasons are more practical than commercial: How many people visit a public building? When? It will help to improve the planning of the services provided, heating or cooling of the building, facility cleaning, staff shifts and so on. In a museum or a sport stadium you can adjust many parameters to help people enjoy from a better experience while raising the profits.

The technology for counting/tracking people has evolved over time. At the beginning infrared beam counters were used. These were cheap but failure prone, like when two persons pass a door together. Thermal counters were used next. Also cheap but with serious limitations like the short distance from the counting device to the people being counted. Latest technology use video cameras and WiFi, or bluetooth, detectors. Video devices are more expensive as is the software in charge of image processing, more expensive in term of resource consumption. On the positive side, now we can do many more this than counting people. We can track their paths and behavior. Radio signal also is a great method for people tracking, as powerful as video but cheaper in terms of hardware price and algorithm cost. The range of detection is wider, 100m approximately.

% TODO: ANTONIO - Meter estado del arte en Smart City y enlazar con lo de movilidad.

*** COMPLETAR ***

%------------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  MOBYWIT  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%------------------------------------------------------------------------------

\section{MOBYWIT}
\label{sec:mobywit}

This device was designed by one of the authors and it is based in a single-board computer, Raspberri Pi\footnote{https://es.wikipedia.org/wiki/Raspberry\_Pi}. It has two USB cards, namely a Bluetooth (BT) and WiFi ones, and it uses their interfaces in monitor mode, scanning the radioelectric space searching for BT devices and beacon frames (for WiFi).

Every device, called MOBYWIT (Mobility by Wireless Tracking) is formed by a hardware and a software layer very interconnected. It is part in the whole monitoring system, which also includes Cloud-based storage and computing services. The software architecture of the whole system is shown in Figure \ref{fig:mobywit}.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[scale=0.4]{imgs/mobywit.eps}
		\caption{Monitoring system architecture}
	\label{fig:mobywit}
	\end{center}
\end{figure}

As it can be seen in that figure, there are six main parts in the software layer of the system, which are unidirectionally connected by a strict data flow. They are have been named as:
\begin{itemize}

\item \textit{Raziel}: This module is in charge of the detections of BT and WiFi devices as well as of their identification (extracting and encrypting the MAC) and the periodic submission of this information to the server. It is run in the device and implemented in Java.

\item \textit{Lilith}: This module acts as a gateway between the network of devices and the server. It allows the communications between nodes and between them and external networks. This component is also run in every device and implemented in PHP.

\item \textit{Abdiel}: This component implements a set of services for accessing the devices from `outside' (mainly for activate/deactivate or update them). In addition it performs the storage of gathered data (in blocks) in the server database. It is also implemented in PHP.

\item \textit{Alejandría}: This is the database of the system. It is a MySQL instance placed in a local server. It is optimized (using indexes and table partitioning) to provide a close to real-time processing and data service.
Ezequiel: This module is responsible of the publication of data in a cloud-based storage. It includes data mining, machine learning and forecast techniques to process these data in order to publish interesting or useful information about them.

\item \textit{Anan}: This is the cloud-based storage and services. It is based in Google technology so Anan stores and manages the data in a NoSQL format, by means of Google Fusion Tables. It also offers advanced visualization methods to be more usable and attractive for the end-user of the system.

\end{itemize}

In addition, and as it is shown in Figure 1, the device runs an specific Operative System, called \textit{Horeb}, which is a modification of the original Raspbian 3.10.24, adapted by MOBYWIT system designer to be more robust (to power fails, for instance) and reliable.

%----------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%   PEOPLE'S MOBILITY IN A DISCO  %%%%%%%%%%%%%%%%%%%%
%----------------------------------------------------------------------------

\section{Analysis of people's mobility in a discotheque}
\label{sec:disco}

In the first scenario of this work, a Discotheque has been monitored using five MOBYWIT devices, deployed one in every of the three main rooms (each room devoted to a type of music), one on the main entrance, and one in the terrace.
% Antonio - JJ, revisa y completa esto, por favor

A total of 2200 different devices were detected in one of the busy nights (from a Thursday at 8 pm to Friday at 8 am), distributed per node as it is shown in Figure \ref{fig:disco_data}.

\begin{figure}[ht]
	\begin{center}
		\includegraphics[width=\textwidth]{imgs/DISCO/time_series-bars.eps}
		\caption{Detected devices in a night in the Discotheque scenario.}
		% Antonio - explicar lo que se ve en las gráficas (histograma y serie). Lo de la serie quizá no sea necesario
		\label{fig:disco_data}
	\end{center}
\end{figure}
% Antonio - Antares porfa, genera la gráfica correctas. ;)
% TODO: ANTARES - Gráfica correcta

These data have been processed and several variables have been extracted from them, in order to apply clustering methods.

The clustering study has been conducted by means of a Self-Organizing Map (SOM) \cite{Kohonen90}, a feed-forward neural network \cite{NN_Haykin94} that uses an unsupervised training algorithm and nonlinear regression techniques to learn or find unknown relationships among the set of variables that describe a problem. The main property of the SOM is that it makes a nonlinear projection from a high-dimensional data space on a regular, low-dimensional (usually 2D) grid of neurons, called units. This grid can be later processed to obtain the unified distance matrix (U-matrix) \cite{UmatUlts} which uses SOM yielded neurons' codevectors (vectors of variables of the problem) as data source, and generates a matrix where each component is a distance measure between two adjacent neurons. Then, these distances are codified as different color shades in a graph. 
The U-Matrix graph allows visualize any multi-variable dataset in a two-dimensional display, which helps detecting topological relations among neurons and inferring about the input data structure in a straightforward visual manner. High values in the U-matrix represent a frontier region between clusters, and low values represent a high degree of similarities among neurons on that region, i.e. clusters. MATLAB 2009 along with SOM Toolbox \cite{SOMPAK} was used for the SOM analysis.

In order to analyze the data, several features have been extracted (generated) from the gathered `steps', composing a pattern per device of its whole stay in the disco. These are described in Table \ref{tab:features_disco}.

\begin{table}[htpb]
\centering
{\scriptsize
\begin{tabular}{lll}
\hline\noalign{\smallskip}
Variable name & Description & Type\\
\noalign{\smallskip}\hline\noalign{\smallskip}
\texttt{entrance\_time} & First date/time when the device was detected & Date\\
\texttt{out\_time} & Last date/time when the device was detected  & Date\\
\texttt{stay\_time} & Number of seconds the device has been in the disco & Integer\\
\texttt{abs\_time\_node\_X} & Number of seconds the device has been detected\\ 
& in every node X (from 1 to 5) & Integer\\
\texttt{relat\_time\_node\_X} & Percentage of time the device has been detected\\ 
& in every node X (from 1 to 5) & Float\\
\texttt{relat\_night\_time\_node\_X} & Percentage of time the device has been detected\\ 
& in every node X (from 1 to 5) regarding the whole timetable\\ 
& of the disco & Float\\
%\texttt{non\_detected\_time} & Number of seconds the device has not been detected (but it still is in the disco) & Integer\\
\noalign{\smallskip}\hline
\end{tabular}
 \caption{Extracted features from gathered data in the discotheque. \label{tab:features_disco}}
}
\end{table}


The application of SOM + U-Matrix produces the graphs shown in Figure 
%\ref{fig:som_disco_no_detec_0} and 
\ref{fig:som_disco_sin_no_detec}.

%\begin{figure}[ht]
%	\begin{center}
%		\includegraphics[width=14cm]{imgs/DISCO/som_disco_no_detec_0.eps}
%		\includegraphics[width=8cm]{imgs/DISCO/umatrix_disco_no_detec_0.eps}
%		\caption{Detected devices in a night in the Discotheque scenario. Extracted features}
% Antonio - Ajustados los no detectados a 0
%		\label{fig:som_disco_no_detec_0}
%	\end{center}
%\end{figure}

\begin{figure}[!ht]
	\begin{center}
		\includegraphics[width=14cm]{imgs/DISCO/som_disco_sin_no_detec.eps}
		\includegraphics[width=8cm]{imgs/DISCO/umatrix_disco_sin_no_detec.eps}
		\caption{Detected devices in a night in the Discotheque scenario. Extracted features}
% Antonio - Sin no detectados
		\label{fig:som_disco_sin_no_detec}
	\end{center}
\end{figure}

*** PONER LOS NOMBRES DE LAS VARIABLES CORRECTOS ***

The results show that... *** COMENTARLOS ***
The problem is that there are no labels on the graph, so the interpretation cannot be as complete as it could... ***


In addition, another study has been conducted using SOM and U-MATRIX graphs. This time we want to analyze the \textit{recurrence of devices} to the discotheque, and their overall behaviour in the days they have come back. To this aim a new dataset has been composed, extracting those `steps' of devices detected in more than two nights in two whole months.
For each device, we have computed a sum of the amounts of diary time per monitoring node. Relative times have been also calculated as another set of features. There are 220000 monitored `steps' and 2100 different devices, so this amount of patterns to cluster.

We have labelled the data using the number of different days every device has been detected (the recurrence rate).

The results on this study are shown in Figure \ref{fig:som_disco_recurrencia}.

\begin{figure}[!ht]
	\begin{center}
		\includegraphics[width=14cm]{imgs/DISCO/som_recurrentes.eps}
		\includegraphics[width=8cm]{imgs/DISCO/umatrix_recurrentes.eps}
		\caption{Recurrence of devices in different days. The label is the recurrence rate of the majority in that neuron/BMU}
		\label{fig:som_disco_recurrencia}
	\end{center}
\end{figure}

*** PONER GRÁFICA CON DATOS Y VARIABLES DEFINITIVAS ***

As it can be seen in the U-Matrix every neuron (cell in the graph) has been labelled according to the class of the majority of the most similar input patterns. To this end the distance from every pattern to every neuron is computed considering their respective codevectors, the closest neuron to an input is named the best matching unit (BMU), and it is labelled with the pattern class (stage in this problem). Once the process has finished every neuron with more than one associated class finally displays the label with more occurrences.

*** COMENTAR RESULTADOS ***

%----------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%  PEOPLE'S MOBILITY IN A BUILDING  %%%%%%%%%%%%%%%%%%%%%%
%----------------------------------------------------------------------------

\section{Analysis of people's mobility in a building of the University}
\label{sec:etsiit}

In this case of study we will focus on people's mobility (as explained in Section \ref{sec:soa}) in a public building: the School of Informatics (ETSIIT) at the University of Granada. In order to monitor people motion flows, three devices have been placed in the three accesses to the building, as it can be seen on Figure \ref{fig:etsiit}.

\begin{figure}[!ht]
	\begin{center}
		\includegraphics[height=4cm]{imgs/etsiit_nodes.eps}
		\caption{MOBYWIT devices location in ETSIIT}
		\label{fig:etsiit}
	\end{center}
\end{figure}

Since the devices can capture data from the university staff and the students, two of them has been placed very close of the main access trying aiming to distinguish staff (62) from students (52). The parking door (42) can be used only by the staff.


%----------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%   TRAFFIC in a HIGHWAY  %%%%%%%%%%%%%%%%%%%%%%%%%
%----------------------------------------------------------------------------

\section{Analysis of the traffic in a highway}
\label{sec:traffic}

This section describes the experimental analysis of the data gathered by a different number of devices placed in national highways.

The main difference with respect to the other experimental scenarios is that, in this case, the detected devices are cars moving at higher speed. However, in this scenario we also count with the information provided by the Spanish traffic management agency, Direcci\'on General de Tr\'afico (DGT), which is collected using loop detectors. So, in this case, we have used real data in order to validate our approach by comparing the real number of vehicles which has passed a point, with the number of devices detected by MOBYWIT. Thus, a realistic \textit{ratio} between both numbers has been computed.

Six nodes have been placed along different roads in Andalusia (south Spain). Figure \ref{fig:nodosDGT} shows the identifiers of these devices and their exact location. These locations have been chosen because are the nearest ones to existent loop detectors monitored by the DGT, and also, they have Internet connection to allow the transmission of data to our server.

\begin{figure}[htb]
	\begin{center}
		\includegraphics[scale=0.4]{imgs/nodos_dgt.eps}
		\caption{Location of MOBYWIT devices for the highway traffic scenario}
	\label{fig:nodosDGT}
	\end{center}
\end{figure}



% Antonio - Fergu, no sé si no será mejor poner el mapa con los nodos en lugar de sus posiciones en la tabla. Es más comprensible su situación. ;)
% FERGU: Hecho
%DATOS A MOSTRAR:
%1) El total DGT/total nosotros
%2) La media del ratio por 15min
%3) La mediana del ratio por 15min

\subsection{Speed computation}
ORDEN
\begin{enumerate}
    \item Matriz de E/S con frecuencia
    \item Matriz de E/S con tiempos
    \item Grafica de Velocidades
\end{enumerate}

\begin{figure}[htb]
	\begin{center}
		\includegraphics[scale=0.4]{imgs/petra_matrix_freq.eps}
		\caption{Frequency between nodes, detecting the unique vehicle identifiers by our MOBYWIT devices. Every day is grouped in blocks of 4 hours.}
	\label{fig:dgtMatrixFrec}
	\end{center}
\end{figure}


\begin{figure}[htb]
	\begin{center}
		\includegraphics[scale=0.4]{imgs/petra_matrix_travelDuration.eps}
		\caption{Average time between nodes, detecting the unique vehicle identifiers by our MOBYWIT devices. Every day is grouped in blocks of 4 hours.}
	\label{fig:dgtMatrixTime}
	\end{center}
\end{figure}


\subsection{Data validation using other sources of data}

Different metrics will be used to obtain a correct correlation between the number of detected devices and the real number detected by the loop detectors.

\begin{itemize}
\item {\em Total ratio}: ratio between the total number of vehicles detected by the DGT and the total number of vehicles detected by our device.
\item {\em Average of ratios}: as the maximum granularity of the data provided by the DGT is 15 minutes, the sum of all ratios between the DGT data and our data in each 15 minutes section has been divided by the total number of sections to calculate the average.
\item {\em Median ratio}: instead the average ratio as in previous metric, this one uses the median of all ratios.
\item {\em Time ratio}: this metric calculate a vector of ratios separated by hour of the day, instead obtaining a global ratio for all data. An average ratio per hour in the vector is calculated taking into account all the ratios of that hour during all the days we have data.
\item {\em Time median}: as in the previous metric, this one uses a vector of ratios per hour, but every element is calculated using the median, instead the average.
\end{itemize}


Figure \ref{fig:dgtRatios} shows the number of devices of one node, applying the chosen correction ratio.



\begin{figure}[htb]
	\begin{center}
		\includegraphics[scale=0.4]{imgs/petra_graph_DGT-Mobywit-mended.eps}
		\caption{Devices detected by DGT and detected by our device applying the correction ratio.}
	\label{fig:dgtRatios}
	\end{center}
\end{figure}





\input{ts_forecasting_tex/ts_forecasting}


%----------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%   TRAFFIC in a CITY  %%%%%%%%%%%%%%%%%%%%%%%%%%%%
%----------------------------------------------------------------------------

\section{Analysis of the urban traffic in a city}
\label{sec:city}

% TODO: MARIBEL + ANTARES

Study of the traffic with data from the Granada nodes...

%La utilidad de Mobywit dentro del ámbito urbano es la identificación de rutas y la medición de tiempos de desplazamiento entre diversos puntos de la ciudad. En todas las ciudades hay atascos. Un atasco se puede producir por diversas causas y hay varios estudios que los han analizado en ciudades concretas \cite{CausasAtascos1,CausasAtascos2}. Pero si nos centramos en una sola ciudad quizas el analisis es muy concreto, por lo que deberiamos generalizar. En nuestra opinion, no hay duda de que un atasco se produce cuando la capacidad de la via se ve superada por el flujo de vehiculos, independientemente de cual haya sido la causa de haber superado esa capacidad.

%Ante una situacion de atasco, cualquier conductor busca vias alternativas y en muchos casos la informacion de esas vias alternativas es muy importante. Pero dependiendo del destino de cualquier vehiculo, la via alternativa a escoger podrian ser diferentes, por lo que las autoridades, lo que hacen es informar del atasco antes de llegar a el para que sean los conductores los que busquen las vias alternativas de desplazamiento.

%Uno de los grandes problemas de las ciudades son los atascos. Los atascos se producen cuando la capacidad de una via se ve 


% Antonio - Incluir este texto en la sección. ;)
These devices cannot detect all the real persons and vehicles moving close to them, since not all of them will be emitting BT or WiFi signals, but after a poll that we did among 600 people we can conclude that we detect around the 22\% of the drivers due to BT detection and around the 70\% of the drivers due to WiFi detection, which are good figures to be considered as representative of the real traffic flows.



%----------------------------------------------------------------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   CONCLUSIONS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%----------------------------------------------------------------------------

\section{Conclusions}
\label{sec:conclusions}

In this work, we have done several things...

\section{Appendix} %FERGU: MOVER ESTA SECCION DONDE CORRESPONDA

In this appendix...
\begin{table}
\centering
\resizebox{12cm}{!}{
\begin{tabular}{|c|c|p{5cm}|c|c|}
\hline
ID   & Province & Location & Latitude & Longitude \\ \hline
1010 & Granada  & A-44 K.P. 118+300 increasing direction (link A-44 K.P. 118+300 with A-92 K.P. 241+000) & 37.241668  & -3.6526 \\ \hline
1020 & Granada  & A-92 K.P. 294+300 increasing direction  & 37.318763 & -3.137978 \\ \hline
1030 & Granada  & A-92 K.P. 344+950, increasing direction & 37.141298 & -2.710871 \\ \hline
1040 & M{\'a}laga  & A-7  K.P. 241+800, decreasing direction (Link A-7 K.P. 241+800 with A-45 K.P. 142+400) &  36.757427 & -4.426879 \\ \hline
1050 & M{\'a}laga  & A-45 K.P. 121+700, decreasing direction & 36.910454 & -4.444769 \\ \hline
1060 & Granada & A-92 K.P. 177+900, decreasing direction (Link A-92 with A-92M) & 37.136209 & -4.282619 \\ \hline
\end{tabular}
}
\caption{Location of the devices for the highway traffic scenario (K.P. = Kilometric Point).}
\label{tab:nodosDGT}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  ACKNOWLEDGEMENTS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Acknowledgements}
This paper has been funded in part by...

\bibliographystyle{elsarticle-num}
\bibliography{mobility}

\end{document}

